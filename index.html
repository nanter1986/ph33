<!doctype html> 
<html lang="en"> 
	<head> 
		<meta charset="UTF-8" />
		<title>Phaser - Making your first game, part 1</title>
		<script src="//cdn.jsdelivr.net/phaser/2.2.2/phaser.min.js"></script>
		<!--<script src="js/phaser.js"></script>-->
		<style type="text/css">
body {
	margin: 0;
}
		</style>
	</head>
	<body>

		<script type="text/javascript">

			var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });
var text;
var counter = 0;
var button;
var background;
var sprite;
var step=0;
var movable=true;
var destination;
var direction=0;

function preload() {
	game.load.image('robot', 'assets/char.png');
	game.load.image('stepA', 'assets/stepA.png');
	game.load.image('stepB', 'assets/stepB.png');
	game.load.image('left1', 'assets/left1.png');
	game.load.image('left2', 'assets/left2.png');
	game.load.image('left3', 'assets/left3.png');
	game.load.spritesheet('button', 'assets/button_sprite_sheet.png', 193, 71);
	game.load.image('background','assets/back.png');
	left=['left1','left2','left3'];
	stay=['stepA','stepB'];
}

function create() {
	if (!game.device.desktop){ game.input.onDown.add(gofull, this); } //go fullscreen on mobile devices
	//game.stage.backgroundColor = '#182d3b';
	background = game.add.tileSprite(0, 0, 1600, 600, 'background');
	background.scale.setTo(2,1);
	background.visible=true;
	sprite=game.add.sprite(200, 200, 'robot');
	sprite.anchor.set(0.5);
	sprite.scale.setTo(2,2);
	sprite.inputEnabled=true;
	destination=sprite.x;
	text = game.add.text(250, 80, '', { fill: '#ffffff' });
	sprite.events.onInputDown.add(listener,this);
	game.camera.follow(sprite);
	game.input.onTap.add(onTap,this);
}

function listener(){
	if(movable){
		//movable=false;
		//mX=game.input.mousePointer.x;
		//destination=mX;
	}
}

function animate(arrayOfFrames,step){
	//animates any number of frames
	var l=arrayOfFrames.length*10;
	while(step<l){
		sprite.loadTexture(arrayOfFrames[step%arrayOfFrames.length], 0);
		step++;
		if(step==l){
			step=0;
		}
	}

}

function update() {
	text.text='destination1'+destination;
	if(direction==0){
		animate(stay,step)
	}else if(direction==-1){
		animate(left,step)
	}else if(direction==1){	
		animate(left,step)
	}
	if(destination<sprite.x){
		sprite.x--;
		direction=-1;
	}else if(destination>sprite.x){
		sprite.x++;
		direction=1;
	}else{
		destination=sprite.x;
		movable=true;
		direction=0;
	}

}

function gofull() { game.scale.startFullScreen(false);}

function up() {
	console.log('button up', arguments);
}

function over() {
	console.log('button over');
}

function out() {
	console.log('button out');
}

function actionOnClick () {
	//background.visible =! background.visible;
	//mX=game.input.mousePointer.x;
	//mY=game.input.mousePointer.y;
	//sprite.x=mX;
}

function onTap(pointer,doubleTap){
	console.log("tap");
	if(movable){
		movable=false;
		mX=pointer.x;
		destination=mX;
	}
	//sprite.x=pointer.x;
}

		</script>

	</body>
</html>
